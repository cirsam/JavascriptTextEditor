@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
    <p>Learn about <a href="https://docs.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>

    <style>
        #menu button {
            display: inline-block;
        }

        #textEditor {
            width: 500px;
            height: 200px;
        }

        .bold {
            font-weight: bold;
        }

        #italics {
            font-style:italic;
        }
    </style>

    <script>
        $(document).ready(function ($) {

            function getCaretCharacterOffsetWithin(element) {
                var caretOffset = 0;
                var doc = element.ownerDocument || element.document;
                //var win = doc.defaultView || doc.parentWindow;
                var sel;
                if (typeof window.getSelection != "undefined") {
                    sel = window.getSelection();
                    if (sel.rangeCount > 0) {
                        var range = window.getSelection().getRangeAt(0);
                        var preCaretRange = range.cloneRange();
                        preCaretRange.selectNodeContents(element);
                        preCaretRange.setEnd(range.endContainer, range.endOffset);
                        caretOffset = preCaretRange.toString().length;
                    }
                } else if ((sel = doc.selection) && sel.type != "Control") {
                    var textRange = sel.createRange();
                    var preCaretTextRange = doc.body.createTextRange();
                    preCaretTextRange.moveToElementText(element);
                    preCaretTextRange.setEndPoint("EndToEnd", textRange);
                    caretOffset = preCaretTextRange.text.length;
                }
                return caretOffset;
            }

            //function doActionOnTextSelectedText(actionText) {
            //    var anchoreNodeId = document.getElementById("sellectedText");
            //    //document.getElementById("sellectedText").classList.add(actionText);
            //    console.log(document.getElementById("sellectedText").style.fontWeight);
            //    if (document.getElementById("sellectedText").style.fontWeight !== 'bold') {
            //        document.getElementById("sellectedText").style.fontWeight="bold";
            //    } else {
            //        document.getElementById("sellectedText").style.fontWeight = "normal";
            //    }
            //};

            function applyChangesToSelectedText() {

                var uid = document.getElementById('textEditor');

                if (typeof window.getSelection != "undefined") {
                    var textareaText = uid.textContent;
                    var start = getCaretCharacterOffsetWithin(uid);

                    var textareaSellectedText = window.getSelection();
                    var range = textareaSellectedText.getRangeAt(0);
                    var startOffset = start - range.toString().length;
                    var endOffset = start;

                    var replaceText = '<span id="sellectedText" >' + textareaSellectedText + '</span>';

                    var firstText = textareaText.substring(0, startOffset);
                    var secondText = textareaText.substring(endOffset, textareaText.length);

                    var newContent = firstText + replaceText + secondText;
                    uid.innerHTML= newContent;
                    uid.focus();

                    if (startOffset != 0) {
                        range.setStart(uid, 1);
                        range.setEnd(uid, 2);
                    } else {
                        range.setStart(uid, 0);
                        range.setEnd(uid, 1);
                    }

                    textareaSellectedText.addRange(range);
                }
            }



            document.getElementById("textEditor").addEventListener('mouseout', applyChangesToSelectedText, false);

            document.getElementById("boldButton").addEventListener('click', function () {
                if (document.getElementById("sellectedText").style.fontWeight !== 'bold') {
                    document.getElementById("sellectedText").style.fontWeight = "bold";
                } else {
                    document.getElementById("sellectedText").style.fontWeight = "normal";
                }
            }, false);

            document.getElementById("italicsButton").addEventListener('click', function () {
                if (document.getElementById("sellectedText").style.fontStyle !== 'italic') {
                    document.getElementById("sellectedText").style.fontStyle = "italic";
                } else {
                    document.getElementById("sellectedText").style.fontStyle = "normal";
                }
            }, false);

    });
    </script>
    <div>
        <div id="menu">
            <button id="boldButton">Bold</button>
            <button id="italicsButton">Italize</button>
        </div>
    </div>
    <div>
        <div id="textEditor" contenteditable="true">This is a text editor</div>
    </div>
</div>
